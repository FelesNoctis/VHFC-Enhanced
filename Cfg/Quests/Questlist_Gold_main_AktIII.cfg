Ch1_Testing_Facility
{
	MainQuest=1
	Chapter=8
	Rewards=Gold(10000),XP(10000),RandomItem(rarity:rare)
	Task
	{
		TaskID=capture
		State=inactive
	}
	Task
	{
		TaskID=jailor
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Testingfacility_begin,keep
		{
			SetStage=3
		}
	}
	Stage3
	{
		State=Active
		Mark=target,terep_Testing_Facility,Entrance_from_fields,dummy,main
		OnMapChanged:terep_Testing_Facility
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnStoryData:Talk_with_Vlados_done,keep
		{
			SetStage=10
		}
		OnStoryData:Vlados_cell_opened,keep
		{
			SetStage=10
		}
		OnStoryData:Cos_lead_cutscene_done,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Testing_Facility,Cos_lead,soldier,capture
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=capture,Active
		}
		OnStoryData:COS_lead_captured,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		OnSet
		{
			Mark=target,terep_Lair,Jailor_Lair_position,dummy,jailor
			Mark=new,terep_Lair,NPC_Interrogator,npc,jailor
			SetTaskState=capture,Completed
			SetTaskState=jailor,Active
		}
		OnStoryData:Talk_with_Interrogator_done,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		OnSet
		{
			Mark=none,terep_Lair,Jailor_Lair_position,dummy,jailor
			Mark=none,terep_Lair,NPC_Interrogator,npc,jailor
			EnableWaypoint=terep_Haunted_Forest01;Hauntedforest_waypoint1
		}
		State=Completed
	}
}
Ch1_Haunted_Forest1
{
	MainQuest=1
	Chapter=8
	Rewards=Gold(10000),XP(11000),AbilityPoint(2)
	Task
	{
		TaskID=Info
		State=inactive
	}
	Task
	{
		TaskID=enter
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Talk_with_Interrogator_done,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=185
			Mark=target,terep_Lair,Townportal,dummy,main
			Mark=target,terep_Haunted_Forest01,Entrance_from_fields,dummy,main
		}
		OnMapChanged:terep_Haunted_Forest01
		{
			Mark=none,terep_Lair,Townportal,dummy,main
			Mark=none,terep_Haunted_Forest01,Entrance_from_fields,dummy,main
		}
		OnStoryData:First_gnom_cutscene_done,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Haunted_Forest01,gnom_hauntedforest_position,dummy,Info
		OnSet
		{
			Mark=new,terep_Haunted_Forest01,NPC_Gnome_Scavenger,npc,Info
			SetTaskState=main,Completed
			SetTaskState=Info,Active
		}
		OnStoryData:Inkspill_dlg_done,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_ink_mocsar,Entrance_from_fields,dummy,enter
		OnSet
		{
			Mark=none,terep_Haunted_Forest01,NPC_Gnome_Scavenger,npc,main
			AddStoryData=HuntintheDark_achi_done
			SetTaskState=Info,Completed
			SetTaskState=enter,Active
		}
		OnStoryData:Gnarlovoy_start_trigger,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Completed
	}
}
Ch1_Lost_Village
{
	MainQuest=1
	Chapter=8
	Rewards=Gold(15000),XP(15000)
	Stage0
	{
		State=Inactive
		OnStoryData:Gnarlovoy_start_trigger,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_Haunted_Forest02,Entrance_from_fields,dummy,main
		OnSet
		{
			SetAdvanceLevel=190
		}
		OnMapChanged:terep_Haunted_Forest02
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
	}
}
Ch1_The_wraithwoods
{
	MainQuest=1
	Chapter=8
	Rewards=Gold(15000),XP(15000)
	Task
	{
		TaskID=enter_hideout
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Haunted_Forest02
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=195
		}
		OnStoryData:Hideout_finded,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_HF_Arena,Entrance_from_fields,dummy,main
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=enter_hideout,Active
		}
		OnStoryData:Hauntedforest_bossfight_start,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Completed
	}
}
Ch1_The_Hideout
{
	MainQuest=1
	Chapter=8
	Rewards=Gold(15000),XP(15000),SkillPoint(2),AbilityPoint(2)
	Stage0
	{
		State=Inactive
		OnStoryData:Hauntedforest_bossfight_start,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target_pos,terep_HF_Arena,Basalthanor_boss,soldier,main
		OnSet
		{
			SetAdvanceLevel=200
		}
		OnStoryData:Hideout_bossfight_start,keep
		{
			SetGangActive=terep_HF_Arena,Cult_bossfight_soldiers,true
		}
		OnStoryData:Second_chapter_start,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
		OnSet
		{
			SetChapter=9
		}
	}
}
Ch2_Vampire_Invasion
{
	MainQuest=1
	Chapter=9
	Rewards=Gold(15000),XP(15000),AbilityPoint(2)
	Task
	{
		TaskID=find
		State=inactive
	}
	Task
	{
		TaskID=fight
		State=inactive
	}
	Task
	{
		TaskID=Close_inkgate
		State=inactive
	}
	Task
	{
		TaskID=Go_back_OT
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Second_chapter_start,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=205
			Mark=target,terep_Lair,Vlados_Lair_position,dummy,main
			Mark=new,terep_Lair,NPC_CountVlados,npc,main
		}
		OnStoryData:vampire_invasion_start,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		OnSet
		{
			Mark=none,terep_Lair,Vlados_Lair_position,dummy,main
			Mark=none,terep_Lair,NPC_CountVlados,npc,main
			Mark=target,terep_Lair,Townportal,dummy,find
			Mark=target,terep_Ink_Old_Town,vampire_inkgate,dummy,find
			EnableWaypoint=terep_Ink_Old_Town;InkOldTown_waypoint1
			SetTaskState=main,Completed
			SetTaskState=find,Active
		}
		OnStoryData:vampiregate_found,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		OnSet
		{
			Mark=none,terep_Lair,Townportal,dummy,find
			Mark=none,terep_Ink_Old_Town,vampire_inkgate,dummy,find
			Mark=target,terep_Ink_Old_Town,vampire_inkgate_monsters,dummy,fight
			SetTaskState=find,Completed
			SetTaskState=fight,Active
			SetGangActive=terep_Ink_Old_Town,Vampire_gatekeeper,true
			CheckSquadAlive=Vampire_gatekeeper,terep_Ink_Old_Town
		}
		OnSoldierGroupKilled:Vampire_gatekeeper,terep_Ink_Old_Town
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		OnSet
		{
			Mark=none,terep_Ink_Old_Town,vampire_inkgate_monsters,dummy,fight
			Mark=target,terep_Ink_Old_Town,vampire_inkgate,dummy,Close_inkgate
			SetTaskState=fight,Completed
			SetTaskState=Close_inkgate,Active
			EnableTrigger=terep_Ink_Old_Town,Vampire_inkgate_location,true
		}
		OnStoryData:Vampiregate_closed,keep
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Active
		OnSet
		{
			Mark=none,terep_Ink_Old_Town,vampire_inkgate,dummy,Close_inkgate
			Mark=target,terep_Lair,Vlados_Lair_position,dummy,Go_back_OT
			Mark=completed,terep_Lair,NPC_CountVlados,npc,Go_back_OT
			SetTaskState=Close_inkgate,Completed
			SetTaskState=Go_back_OT,Active
		}
		OnStoryData:Dark_Carnival_available,keep
		{
			SetStage=30
		}
	}
	Stage30
	{
		State=Completed
		OnSet
		{
			Mark=none,terep_Lair,Vlados_Lair_position,dummy,Go_back_OT
			Mark=none,terep_Lair,NPC_CountVlados,npc,Go_back_OT
		}
	}
}
Ch2_Dark_Carnival
{
	MainQuest=1
	Chapter=9
	Rewards=Gold(15000),XP(15000)
	Task
	{
		TaskID=ringmaster
		State=inactive
	}
	Task
	{
		TaskID=Fata_morgana
		State=inactive
	}
	Task
	{
		TaskID=Enter
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Dark_Carnival_available,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=210
			Mark=target,terep_Lair,Townportal,dummy,main
			Mark=new,terep_Dark_Carnival,NPC_Fata_Morgana,npc,main
			Mark=target,terep_Dark_Carnival,Fata_Morgana_position,dummy,main
			EnableWaypoint=terep_Dark_Carnival;Dark_Carnival_waypoint
		}
		OnStoryData:Hunter_games_beginning,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		OnStoryData:start_ringmaster_hunt,keep
		{
			SetStage=15
		}
		OnStoryData:Arena_Fight_cutscene,keep
		{
			SetStage=20
		}
	}
	Stage15
	{
		State=Active
		OnSet
		{
			Mark=none,terep_Lair,Townportal,dummy,main
			Mark=none,terep_Dark_Carnival,NPC_Fata_Morgana,npc,main
			Mark=none,terep_Dark_Carnival,Fata_Morgana_position,dummy,main
			Mark=target,terep_Dark_Carnival,Ringmaster_position,dummy,ringmaster
			SetTaskState=main,Completed
			SetTaskState=ringmaster,Active
		}
		OnStoryData:Arena_Fight_cutscene,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		OnStoryData:Arena_Fight_cutscene_end,keep
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Active
		OnSet
		{
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,firstround_squad
			SpawnMonster=Massacrare_Brothers_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,firstround_squad
			SpawnMonster=Massacrare_Brothers_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,firstround_squad
			SpawnMonster=Killer_Clown_highrange,firstround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,firstround_squad
			EnableEntrance=terep_Dark_Carnival,Bossportal1,true
			EnableEntrance=terep_Dark_Carnival,Bossportal2,true
		}
		OnSoldierKilledName:firstround_soldier,terep_Dark_Carnival
		{
			CountSoldiers=terep_Dark_Carnival,firstround_soldier,ringmaster_soldier01_remaining,name
		}
		OnVariableChanged:ringmaster_soldier01_remaining,0
		{
			SetStage=30
		}
	}
	Stage30
	{
		State=Active
		OnSet
		{
			AddStoryData=firstround_cutscene_start
		}
		OnStoryData:firstround_cutscene_end,keep
		{
			SetStage=35
		}
	}
	Stage35
	{
		State=Active
		OnSet
		{
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,secondround_squad
			SpawnMonster=Massacrare_Brothers_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,secondround_squad
			SpawnMonster=Hollow_Lord_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,secondround_squad
			SpawnMonster=Massacrare_Brothers_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,secondround_squad
			SpawnMonster=Killer_Clown_highrange,secondround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,secondround_squad
		}
		OnSoldierKilledName:secondround_soldier,terep_Dark_Carnival
		{
			CountSoldiers=terep_Dark_Carnival,secondround_soldier,ringmaster_soldier02_remaining,name
		}
		OnVariableChanged:ringmaster_soldier02_remaining,0
		{
			SetStage=40
		}
	}
	Stage40
	{
		State=Active
		OnSet
		{
			AddStoryData=secondround_cutscene_start
		}
		OnStoryData:secondround_cutscene_end,keep
		{
			SetStage=45
		}
	}
	Stage45
	{
		State=Active
		OnSet
		{
			SpawnMonster=Mysterious_Cerambyx_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,thirdround_squad
			SpawnMonster=Killer_Clown_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,thirdround_squad
			SpawnMonster=Killer_Clown_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,thirdround_squad
			SpawnMonster=Mysterious_Cerambyx_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,thirdround_squad
			SpawnMonster=Massacrare_Brothers_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,thirdround_squad
			SpawnMonster=Hollow_Lord_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,thirdround_squad
			SpawnMonster=Massacrare_Brothers_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,thirdround_squad
			SpawnMonster=Hollow_Lord_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,thirdround_squad
			SpawnMonster=Killer_Clown_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,thirdround_squad
			SpawnMonster=Massacrare_Brothers_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,thirdround_squad
			SpawnMonster=Mysterious_Cerambyx_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,thirdround_squad
			SpawnMonster=Killer_Clown_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit01,unnamed_player,thirdround_squad
			SpawnMonster=Killer_Clown_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit02,unnamed_player,thirdround_squad
			SpawnMonster=Killer_Clown_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit03,unnamed_player,thirdround_squad
			SpawnMonster=Massacrare_Brothers_highrange,thirdround_soldier,terep_Dark_Carnival,Monsterpit04,unnamed_player,thirdround_squad
		}
		OnSoldierKilledName:thirdround_soldier,terep_Dark_Carnival
		{
			CountSoldiers=terep_Dark_Carnival,thirdround_soldier,ringmaster_soldier03_remaining,name
		}
		OnVariableChanged:ringmaster_soldier03_remaining,0
		{
			SetStage=50
		}
	}
	Stage50
	{
		State=Active
		OnSet
		{
			AddStoryData=thirdround_cutscene_start
		}
		OnStoryData:thirdround_cutscene_end,keep
		{
			SetStage=55
		}
	}
	Stage55
	{
		State=Active
		OnSet
		{
			SpawnMonster=Mad_Ringmaster,Mad_Ringmaster,terep_Dark_Carnival,Ringmaster_position,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Killer_Clown_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit01,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Mysterious_Cerambyx_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit02,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Killer_Clown_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit04,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Massacrare_Brothers_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit01,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Hollow_Lord_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit02,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Massacrare_Brothers_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit03,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Hollow_Lord_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit04,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Killer_Clown_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit01,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Killer_Clown_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit02,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Hollow_Lord_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit03,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Killer_Clown_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit04,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Massacrare_Brothers_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit03,ringmaster,unnamed_player,fourthround_squad
			SpawnMonster=Massacrare_Brothers_highrange,fourthround_soldier,terep_Dark_Carnival,Monsterpit04,ringmaster,unnamed_player,fourthround_squad
			Mark=none,terep_Dark_Carnival,Ringmaster_position,dummy,ringmaster
			Mark=target,terep_Dark_Carnival,Mad_Ringmaster,soldier,ringmaster
			CheckSoldierAlive=Mad_Ringmaster,terep_Dark_Carnival
		}
		OnSoldierKilledName:fourthround_soldier,terep_Dark_Carnival
		{
			CountSoldiers=terep_Dark_Carnival,fourthround_soldier,ringmaster_soldier04_remaining,name
		}
		OnVariableChanged:ringmaster_soldier04_remaining,0
		{
			AddStoryData=all_arenasoldier_eliminated
		}
		OnSoldierKilledName:Mad_Ringmaster,terep_Dark_Carnival
		{
			AddStoryData=ringmaster_eliminated
		}
		OnStoryData:all_arenasoldier_eliminated,keep
		{
			HasStoryData:ringmaster_eliminated,equal,1
			{
				SetStage=60
			}
		}
		OnStoryData:ringmaster_eliminated,keep
		{
			HasStoryData:all_arenasoldier_eliminated,equal,1
			{
				SetStage=60
			}
		}
	}
	Stage60
	{
		State=Active
		OnSet
		{
			AddStoryData=Ringmaster_is_dead
			EnableEntrance=terep_Dark_Carnival,Bossportal1,false
			EnableEntrance=terep_Dark_Carnival,Bossportal2,false
			HasStoryData:start_ringmaster_hunt,equal,1
			{
				Mark=none,terep_Dark_Carnival,Mad_Ringmaster,soldier,ringmaster
				Mark=Completed,terep_Dark_Carnival,NPC_Fata_Morgana,npc,Fata_morgana
				Mark=target,terep_Dark_Carnival,Fata_Morgana_position,dummy,Fata_morgana
				SetTaskState=ringmaster,Completed
				SetTaskState=Fata_morgana,Active
			}
		}
		OnStoryData:Nightmare_Hollow_available,keep
		{
			SetStage=65
		}
	}
	Stage65
	{
		State=Active
		Mark=target,terep_Dark_Carnival,Chaosgate_position,dummy,Enter
		OnSet
		{
			HasStoryData:start_ringmaster_hunt,equal,0
			{
				Mark=none,terep_Lair,Townportal,dummy,main
				Mark=none,terep_Dark_Carnival,NPC_Fata_Morgana,npc,main
				Mark=none,terep_Dark_Carnival,Fata_Morgana_position,dummy,main
				SetTaskState=main,Completed
			}
			HasStoryData:start_ringmaster_hunt,equal,1
			{
				Mark=none,terep_Dark_Carnival,NPC_Fata_Morgana,npc,Fata_morgana
				Mark=none,terep_Dark_Carnival,Fata_Morgana_position,dummy,Fata_morgana
				SetTaskState=Fata_morgana,Completed
			}
			EnableEntrance=terep_Dark_Carnival,Entrance_to_Nightmare_Hollow,true
			SetTaskState=Enter,Active
		}
		OnMapChanged:terep_Nightmare_Hollow01
		{
			SetTaskState=Enter,Completed
			SetStage=70
		}
	}
	Stage70
	{
		State=Completed
	}
}
Ch2_Nightmare_Hollow
{
	MainQuest=1
	Chapter=9
	Rewards=Gold(15000),XP(15000),RandomItem(rarity:rare)
	Task
	{
		TaskID=Enter_Necropolis
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Nightmare_Hollow01
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=215
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Nightmare_Hollow01;Entrance_from_fields,true
			EnableTrigger=terep_Lair,Lair_ink_map_opened,true
		}
		OnStoryData:Second_circle_finded,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Nightmare_Hollow01,Second_circle_entrance,dummy,main
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=Enter_Necropolis,Active
		}
		OnMapChanged:terep_Nightmare_Hollow02
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Completed
		
	}
}
Ch2_Necropolis
{
	MainQuest=1
	Chapter=9
	Rewards=Gold(15000),XP(15000),RandomItem(rarity:rare)
	Task
	{
		TaskID=Enter_ImpTomb
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Nightmare_Hollow02
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=220
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Nightmare_Hollow02;Entrance_from_fields,true
		}
		OnStoryData:Third_circle_finded,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Nightmare_Hollow02,Third_circle_entrance,dummy,main
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=Enter_ImpTomb,Active
		}
		OnMapChanged:terep_Nightmare_Hollow03
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Completed
	}
}
Ch2_Impossible_Tombs
{
	MainQuest=1
	Chapter=9
	Rewards=Gold(15000),XP(15000),SkillPoint(1),AbilityPoint(2)
	
	Task
	{
		TaskID=Free_soul
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Nightmare_Hollow03
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=225
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Nightmare_Hollow03;Entrance_from_fields,true
		}
		OnStoryData:Saving_Irinas_soul_start,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Nightmare_Hollow03,Lady_Irina_Bad,soldier,Free_soul
		OnSet
		{
			SetPlayerFaction=terep_Nightmare_Hollow03,Irinas_bodyguards,1
			SetGangActive=terep_Nightmare_Hollow03,NHI_bodyguards,true
			SetTaskState=main,Completed
			SetTaskState=Free_soul,Active
		}
		OnStoryData:Irina_gone,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Completed
		OnSet
		{
			EnableEntrance=terep_Nightmare_Hollow03,Entrance_to_Spectral_Provinces,true
			SetChapter=10
		}
	}
}
Ch3_Spectral_Provinces
{
	MainQuest=1
	Chapter=10
	Rewards=Gold(5000),XP(15000)
	Task
	{
		TaskID=Talk_locals
		State=inactive
	}
	Task
	{
		TaskID=Destroy_Inkgrub
		State=inactive
	}
	Task
	{
		TaskID=Enter_frozen
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Irina_gone,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_Nightmare_Hollow03,Irinas_gate,dummy,main
		OnMapChanged:terep_Ink_mythical
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Ink_mythical,NPC_Von_Sturm,npc,Talk_locals
		OnSet
		{
			SetAdvanceLevel=230
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Ink_mythical;Entrance_from_fields,true
			SetTaskState=main,Completed
			SetTaskState=Talk_locals,Active
		}
		OnStoryData:Von_Sturm_cutscene_done,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_Ink_mythical,Inkgrub_mythical,soldier,Destroy_Inkgrub
		OnSet
		{
			SetTaskState=Talk_locals,Completed
			SetTaskState=Destroy_Inkgrub,Active
			CheckSoldierAlive=Inkgrub_mythical,terep_Ink_mythical
		}
		OnSoldierKilledName:Inkgrub_mythical,terep_Ink_mythical
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_Ink_mythical,Inkgrub_gate_location,dummy,Enter_frozen
		OnSet
		{
			SendRadioReport=Von_Sturm,Von_Sturm_info01
			SetTaskState=Destroy_Inkgrub,Completed
			SetTaskState=Enter_frozen,Active
			EnableEntrance=terep_Ink_mythical,Entrance_to_Ink_frozen,true
		}
		OnStoryData:Frozen_mainquest_start,keep
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Completed
	}
}
Ch3_Ink_mythical_techquest
{
	Chapter=0
	Stage0
	{
		State=Inactive
		OnStoryData:Von_Sturm_transmitter01,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		OnSet
		{
			SendRadioReport=Von_Sturm,Transmitter_prototype
			SetStage=10
		}
	}
	Stage10
	{
		State=Hidden
	}
}
Ch3_Frozen_Island
{
	MainQuest=1
	Chapter=10
	Rewards=Gold(10000),XP(11000)
	Task
	{
		TaskID=explosives
		State=inactive
	}
	Task
	{
		TaskID=blowup
		State=inactive
	}
	Task
	{
		TaskID=destroy
		State=inactive
	}
	Task
	{
		TaskID=enter
		State=inactive
	}
	
	Stage0
	{
		State=Inactive
		OnStoryData:Frozen_mainquest_start,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_Ink_frozen,ruined_bridge_location,dummy,main
		OnSet
		{
			SetAdvanceLevel=235
		}
		OnStoryData:Frozen_need_explosives,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		
		OnSet
		{
			Mark=target,terep_Ink_frozen,Gnome_trader_loc,dummy,explosives
			Mark=completed,terep_Ink_frozen,NPC_Gnome_trader,npc,explosives
			SetTaskState=main,Completed
			SetTaskState=explosives,Active
		}
		OnStoryData:Frozen_explosives_got,keep
		{
			SetStage=12
		}
	}
	Stage12
	{
		State=Active
		OnSet
		{
			AddLoot=Gnome_bomb_loot,terep_Ink_frozen,gnome_trader_loc,dummy
			Mark=none,terep_Ink_frozen,Gnome_trader_loc,dummy,explosives
			Mark=none,terep_Ink_frozen,NPC_Gnome_trader,npc,explosives
		}
		OnItemGot:Gnome_Bomb
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_Ink_frozen,ruined_bridge_location,dummy,blowup
		OnSet
		{
			SetTaskState=explosives,Completed
			SetTaskState=blowup,Active
			EnableTrigger=terep_Ink_frozen,Frozen_blowupcutscene,true
		}
		OnStoryData:Frozen_obstacle_removed,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_Ink_frozen,Inkgrub_location,dummy,destroy
		OnSet
		{
			SetTaskState=blowup,Completed
			SetTaskState=destroy,Active
			RemoveArtifact=Gnome_Bomb
			CheckSoldierAlive=Inkgrub_Frozen,terep_Ink_frozen
		}
		OnSoldierKilledName:Inkgrub_Frozen,terep_Ink_frozen
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Active
		Mark=target,terep_Ink_frozen,Inkgrub_gate_location,dummy,enter
		OnSet
		{
			AddStoryData=Frozen_inkgrub_destroyed
			SetTaskState=destroy,Completed
			SetTaskState=enter,Active
			EnableEntrance=terep_Ink_frozen,Entrance_to_ink_darkness,true
		}
		OnMapChanged:terep_Ink_darkness
		{
			SetStage=30
		}
	}
	Stage30
	{
		State=Completed
	}
}
Ch3_Island_of_Terror
{
	MainQuest=1
	Chapter=10
	Rewards=Gold(15000),XP(25000),SkillPoint(1)
	Task
	{
		TaskID=destroy_darkness
		State=inactive
	}
	Task
	{
		TaskID=Enter_glass
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Ink_darkness
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=240
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Ink_darkness;Entrance_from_fields,true
		}
		OnStoryData:Inkgrub_darkness_finded,keep
		{
			SetStage=2
		}
	}
	Stage2
	{
		State=Active
		Mark=target,terep_Ink_darkness,Inkgrub3_location,dummy,destroy_darkness
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=destroy_darkness,Active
			CheckSoldierAlive=Inkgrub_Darkness,terep_Ink_darkness
		}
		OnSoldierKilledName:Inkgrub_Darkness,terep_Ink_darkness
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Ink_darkness,Inkgrub3_gate_location,dummy,Enter_glass
		OnSet
		{
			SetTaskState=destroy_darkness,Completed
			SetTaskState=Enter_glass,Active
			EnableEntrance=terep_Ink_darkness,Entrance_to_ink_glass2,true
		}
		OnMapChanged:terep_Ink_glass2
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Completed
	}
}
Ch3_Castle_Glass
{
	MainQuest=1
	Chapter=10
	Rewards=Gold(10000),XP(10000),AbilityPoint(2)
	Task
	{
		TaskID=Shield_Masters
		State=inactive
	}
	Task
	{
		TaskID=Fourth_Inkgrub
		State=inactive
	}
	Task
	{
		TaskID=Meet_Sturm
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Ink_glass2
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=245
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Ink_glass2;Entrance_from_fields,true
		}
		OnStoryData:Masters_of_shield,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=Shield_Masters,Active
			Mark=target,terep_Ink_glass2,Shield_Master1,soldier,Shield_Masters
			Mark=target,terep_Ink_glass2,Shield_Master2,soldier,Shield_Masters
			Mark=target,terep_Ink_glass2,Shield_Master3,soldier,Shield_Masters
			CheckSoldierAlive=Shield_Master1,terep_Ink_glass2
			CheckSoldierAlive=Shield_Master2,terep_Ink_glass2
			CheckSoldierAlive=Shield_Master3,terep_Ink_glass2
		}
		OnSoldierKilledName:Shield_Master1,terep_Ink_glass2
		{
			Mark=none,terep_Ink_glass2,Shield_Master1,soldier,Shield_Masters
			AddStoryData=glass_Shield_Master1_killed
		}
		OnSoldierKilledName:Shield_Master2,terep_Ink_glass2
		{
			Mark=none,terep_Ink_glass2,Shield_Master2,soldier,Shield_Masters
			AddStoryData=glass_Shield_Master2_killed
		}
		OnSoldierKilledName:Shield_Master3,terep_Ink_glass2
		{
			Mark=none,terep_Ink_glass2,Shield_Master3,soldier,Shield_Masters
			AddStoryData=glass_Shield_Master3_killed
		}
		OnStoryData:glass_Shield_Master1_killed,keep
		{
			SetVariable=Dead_Shield_Masters,1,add
		}
		OnStoryData:glass_Shield_Master2_killed,keep
		{
			SetVariable=Dead_Shield_Masters,1,add
		}
		OnStoryData:glass_Shield_Master3_killed,keep
		{
			SetVariable=Dead_Shield_Masters,1,add
		}
		OnVariableChanged:Dead_Shield_Masters,3
		{
			SetStage=12
		}
	}
	Stage12
	{
		State=Active
		OnSet
		{
			AddStoryData=All_shieldmasters_dead
		}
		OnStoryData:glass_inkgrub_shield_destroyed,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_Ink_glass2,Inkgrub_gate4_location,dummy,Fourth_Inkgrub
		OnSet
		{
			SetTaskState=Shield_Masters,Completed
			SetTaskState=Fourth_Inkgrub,Active
			SetGangActive=terep_Ink_glass2,Fourth_Inkgrub,true
			CheckSoldierAlive=Inkgrub_Glass2,terep_Ink_glass2
		}
		OnSoldierKilledName:Inkgrub_Glass2,terep_Ink_glass2
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_Ink_glass2,Inkgrub_gate4_location,dummy,Meet_Sturm
		OnSet
		{
			SendRadioReport=Von_Sturm,Clockwork_Meet
			SetTaskState=Fourth_Inkgrub,Completed
			SetTaskState=Meet_Sturm,Active
			EnableEntrance=terep_Ink_glass2,Entrance_to_Clockwork_Keep,true
			AddStoryData=Signallost_achi_done
		}
		OnStoryData:Meeting_done,keep
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Completed
	}
}
Ch3_Koscheis_relic
{
	MainQuest=1
	Chapter=10
	Rewards=Gold(5000),XP(10000),RandomItem(rarity:rare),SkillPoint(1)
	Task
	{
		TaskID=Turnon_controller
		State=inactive
	}
	Task
	{
		TaskID=desintegrator
		State=inactive
	}
	Task
	{
		TaskID=Destroy_relic
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Meeting_done,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SetAdvanceLevel=250
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Clockwork_Keep;Entrance_from_fields,true
			Mark=target_pos,terep_Clockwork_Keep,CK_interface1_loc,dummy,main
			Mark=target_pos,terep_Clockwork_Keep,CK_interface2_loc,dummy,main
		}
		OnStoryData:Power_interface1_active,keep
		{
			SetVariable=active_power_interface,1,add
			Mark=none,terep_Clockwork_Keep,CK_interface1_loc,dummy,main
		}
		OnStoryData:Power_interface2_active,keep
		{
			SetVariable=active_power_interface,1,add
			Mark=none,terep_Clockwork_Keep,CK_interface2_loc,dummy,main
		}
		OnVariableChanged:active_power_interface,2
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target_pos,terep_Clockwork_Keep,CK_controller_position,dummy,Turnon_controller
		OnSet
		{
			SendRadioReport=Von_Sturm,Second_phase
			SetTaskState=main,Completed
			SetTaskState=Turnon_controller,Active
		}
		OnStoryData:desintegrator_available,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target_pos,terep_Clockwork_Keep,Desintegrator_item,dummy,desintegrator
		OnSet
		{
			AddLoot=CK_desintegrator_loot,terep_Clockwork_Keep,Desintegrator_position,dummy
			SendRadioReport=Von_Sturm,Third_phase
			SetTaskState=Turnon_controller,Completed
			SetTaskState=desintegrator,Active
		}
		OnItemGot:CK_desintegrator
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_Clockwork_Keep,Koscheis_relic_location,dummy,Destroy_relic
		OnSet
		{
			SetTaskState=desintegrator,Completed
			SetTaskState=Destroy_relic,Active
			EnableTrigger=terep_Clockwork_Keep,destroy_relic_cutstart,true
		}
		OnStoryData:destroy_relic_object
		{
			SetObjectVisible=terep_Clockwork_Keep,Koscheis_relic,false
		}
		OnStoryData:CK_finalcut_end
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Completed
		OnSet
		{
			EnableEntrance=terep_Clockwork_Keep,Entrance_to_kapubirtok,true
			SetChapter=11
		}
	}
}
Ch4_The_Gatekeeper
{
	MainQuest=1
	Chapter=11
	Rewards=Gold(15000),XP(15000),AbilityPoint(5)
	Task
	{
		TaskID=Gatekeeper
		State=inactive
	}
	Task
	{
		TaskID=Champion_fight
		State=inactive
	}
	Task
	{
		TaskID=Deep_Ink
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:CK_finalcut_end,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_Kapubirtok,Entrance_from_fields,dummy,main
		OnSet
		{
			SetAdvanceLevel=255
		}
		OnMapChanged:terep_Kapubirtok
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Kapubirtok,Gatekeeper_location,dummy,Gatekeeper
		OnSet
		{
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Kapubirtok;Entrance_from_fields,true
			SetTaskState=main,Completed
			SetTaskState=Gatekeeper,Active
		}
		OnStoryData:Gatekeeper_champion_fight_start,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_Kapubirtok,Gatekeeper_champion,soldier,Champion_fight
		OnSet
		{
			SetTaskState=Gatekeeper,Completed
			SetTaskState=Champion_fight,Active
			SpawnMonster=Three_Headed_Dragon_boss,Gatekeeper_champion,terep_Kapubirtok,Gatekeeper_champion_locatin
			CheckSoldierAlive=Gatekeeper_champion,terep_Kapubirtok
		}
		OnSoldierKilledName:Gatekeeper_champion,terep_Kapubirtok
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_pokol1,Entrance_from_fields,dummy,Deep_Ink
		OnSet
		{
			SetTaskState=Champion_fight,Completed
			SetTaskState=Deep_Ink,Active
			EnableEntrance=terep_Kapubirtok,Entrance_to_Deep_Ink,true
			AddStoryData=Masterduelist_achi_done
		}
		OnStoryData:Ghost_travellers_cutscene,keep
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Completed
	}
}
Ch4_Titanslayer_Relic
{
	MainQuest=1
	Chapter=11
	Rewards=Gold(25000),XP(25000),SkillPoint(1)
	Task
	{
		TaskID=Meet_travellers
		State=inactive
	}
	Task
	{
		TaskID=Enter_pokolgate
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Ghost_travellers_cutscene,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		OnSet
		{
			SpawnMonster=NPC_Ghost_traveller_leader,NPC_Ghost_traveller_leader,terep_Pokol1,Ghost_traveller_pos1,Inktravellers_player
			AddStoryData=Gtraveller_done
		}
		OnStoryData:Gtraveller1_cutscene_done,keep
		{
			SetStage=7
		}
	}
	Stage7
	{
		State=Inactive
		OnSet
		{
			SpawnMonster=NPC_ghost_traveller,ghost_traveller1,terep_Pokol1,Ghost_traveller_pos2,Inktravellers_player
			SpawnMonster=NPC_ghost_traveller,ghost_traveller2,terep_Pokol1,Ghost_traveller_pos3,Inktravellers_player
			SpawnMonster=NPC_ghost_traveller,ghost_traveller3,terep_Pokol1,Ghost_traveller_pos4,Inktravellers_player
			AddStoryData=second_GTcutscene_start
		}
		OnStoryData:titanslayer_quest_begin,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_Pokol1,titanslayer_corpse_location,dummy,main
		OnSet
		{
			SetAdvanceLevel=260
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Pokol1;Entrance_from_fields,true
			SpawnMonster=NPC_Ghost_traveller_leader,NPC_Ghost_traveller_leader,terep_Pokol1,Traveller_endpos1,Inktravellers_player
			SpawnMonster=NPC_ghost_traveller,ghost_traveller1,terep_Pokol1,Traveller_endpos2,Inktravellers_player
			SpawnMonster=NPC_ghost_traveller,ghost_traveller2,terep_Pokol1,Traveller_endpos3,Inktravellers_player
			SpawnMonster=NPC_ghost_traveller,ghost_traveller3,terep_Pokol1,Traveller_endpos4,Inktravellers_player
		}
		OnStoryData:TS_relic_dropped,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_Pokol1,Traveller_endpos1,dummy,Meet_travellers
		OnSet
		{
			AddLoot=The_aegis_loot
			SetObjectVisible=terep_Pokol1,titanslayer_relic_jewel,false
			AddStoryData=crazyoldman_spawn
			EnableTrigger=terep_Pokol1,titanslayer_endcutscene,true
			EnableTrigger=terep_Pokol1,TD9_start,true
			SetTaskState=main,Completed
			SetTaskState=Meet_travellers,Active
			SpawnMonster=succubus_vet,succubus_vet,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=succubus_vet,succubus_vet,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=succubus_vet,succubus_vet,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=succubus_vet,succubus_vet,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=Demon_dog_red,Demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
			SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers02
		}
		OnStoryData:spawn_ink_travellers,keep
		{
			SetStage=17
		}
	}
	Stage17
	{
		State=Active
		OnSet
		{
			SpawnMonster=Ink_traveller_elit,Ink_traveller_elit,terep_Pokol1,Traveller_endpos1
			SpawnMonster=Basalthanor_min,Basalthanor_min,terep_Pokol1,Traveller_endpos2
			SpawnMonster=Basalthanor_min,Basalthanor_min,terep_Pokol1,Traveller_endpos3
			SpawnMonster=Basalthanor_min,Basalthanor_min,terep_Pokol1,Traveller_endpos4
			EnableEntrance=terep_Pokol1,tower_of_torment_entrance,true
			AddStoryData=Inktravellers_lastcutscene
		}
		OnStoryData:Fight_for_titanslayer_relic,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_pokol2,Entrance_from_fields,dummy,Enter_pokolgate
		OnSet
		{
			SetTaskState=Meet_travellers,Completed
			SetTaskState=Enter_pokolgate,Active
		}
		OnMapChanged:terep_pokol2
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Completed
	}
}
Ch4_Crazyoldman
{
	Chapter=11
	Stage0
	{
		State=Inactive
		OnStoryData:crazyoldman_spawn,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=Completed,terep_Pokol1,NPC_crazyoldman,npc,main
		OnStoryData:Crazyoldman_dialog,keep
		{
			SetStage=10
		}
		OnStoryData:Fight_for_titanslayer_relic,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Hidden
	}
}
Ch4_Tower_of_Torment
{
	MainQuest=1
	Chapter=11
	Rewards=Gold(15000),XP(15000),SkillPoint(1),AbilityPoint(1)
	Task
	{
		TaskID=Enter_VC
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_pokol2
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_pokol2,Void_Cathedral_entrance,dummy,main
		OnSet
		{
			SetAdvanceLevel=265
			#EnableMultiEntrance=terep_Lair,Ink_multientrance,terep_Pokol2;Entrance_from_fields,true
		}
		OnStoryData:Koscsej_endcut_done,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_pokol2,Void_Cathedral_entrance,dummy,main
		OnSet
		{
			CheckSquadAlive=Koscsej_group4,terep_pokol2
		}
		OnSoldierGroupKilled:Koscsej_group4,terep_pokol2
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=target,terep_pokol2,Void_Cathedral_entrance,dummy,Enter_VC
		OnSet
		{
			AddStoryData=Final_map_available
			SetTaskState=main,Completed
			SetTaskState=Enter_VC,Active
			EnableEntrance=terep_Pokol2,Entrance_to_VoidCathedral,true
		}
		OnMapChanged:terep_Void_Cathedral
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Completed
	}
}
Ch4_Koscsej_techquest
{
	Chapter=11
	Stage0
	{
		State=Inactive
		OnStoryData:TS_relic_dropped,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		OnSet
		{
			EnableTrigger=terep_Pokol1,Koscsej_cutscene01,true
			EnableTrigger=terep_Pokol1,Koscsej_cutscene01v2,true
		}
		OnStoryData:Koscsej_cutscene01,keep
		{
			EnableTrigger=terep_Pokol1,Koscsej_cutscene01v2,false
		}
		OnStoryData:Koscsej_cutscene01v2,keep
		{
			EnableTrigger=terep_Pokol1,Koscsej_cutscene01,false
		}
		OnStoryData:Koscsej_firstcut_done,keep
		{
			SetStage=10
		}
		OnStoryData:Koscsej_firstcutv2_done,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Inactive
		OnSet
		{
			HasStoryData:Koscsej_firstcut_done,equal,1
			{
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01
			}
			HasStoryData:Koscsej_firstcutv2_done,equal,1
			{
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers01v2
			}
			EnableTrigger=terep_Pokol1,Koscsej_cutscene02,true
			EnableTrigger=terep_Pokol1,Koscsej_cutscene02v2,true
		}
		OnStoryData:Koscsej_cutscene02,keep
		{
			EnableTrigger=terep_Pokol1,Koscsej_cutscene02v2,false
		}
		OnStoryData:Koscsej_cutscene02v2,keep
		{
			EnableTrigger=terep_Pokol1,Koscsej_cutscene02,false
		}
		OnStoryData:Koscsej_secondcut_done,keep
		{
			SetStage=15
		}
		OnStoryData:Koscsej_secondcutv2_done,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Inactive
		OnSet
		{
			HasStoryData:Koscsej_secondcut_done,equal,1
			{
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03
			}
			HasStoryData:Koscsej_secondcutv2_done,equal,1
			{
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=daimon_judge_vet,daimon_judge_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=daimon_executor_vet,daimon_executor_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=horned_abomination_vet,horned_abomination_vet,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
				SpawnMonster=demon_dog_red,demon_dog_red,terep_Pokol1,Koscsej_followers03v2
			}
		}
		OnMapChanged:terep_pokol2
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Inactive
		OnSet
		{
			AddStoryData=Koscsej_in_pokol2
		}
		OnStoryData:Koscsej_thirdcut_done,keep
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Inactive
		OnSet
		{
			SetGangActive=terep_pokol2,Koscsej_group3,true
		}
		OnStoryData:Koscsej_fourthcut_done,keep
		{
			SetStage=30
		}
	}
	Stage30
	{
		State=Inactive
		OnSet
		{
			SetGangActive=terep_pokol2,Koscsej_group4,true
		}
		OnStoryData:Final_map_available,keep
		{
			SetStage=35
		}
	}
	Stage35
	{
		State=Hidden
	}
}

Ch4_Finalboss
{
	MainQuest=1
	Chapter=11
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_Void_Cathedral
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_Void_Cathedral,Entrance_from_fields_kamu,dummy,main
		OnSet
		{
			AddStoryData=final_boss_start
		}
		OnStoryData:vh3_game_over,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
		OnSet
		{
			SetChapter=12
			SetAdvanceLevel=270
		}
	}
}