Ch1_SpeakWithTheGypsies
{
	Chapter=1
	Rewards=Gold(1000),XP(600),AbilityPoint(1)
	Task
	{
		TaskID=kill_the_beast
		State=Inactive
	}
	Task
	{
		TaskID=go_back
		State=Inactive
	}
	Task
	{
		TaskID=talk_alchemist
		State=Inactive
	}
	OnMapChanged:terep_gyarnegyed
	{
		HasStoryData:Speak_with_the_Gypsies_begin,equal,1
		{
			HasStoryData:dlg_alchemist02_done,equal,0
			{
				SetStage=40
			}
		}
		HasStoryData:Speak_with_the_Gypsies_begin,equal,0
		{
			SetStage=45
		}
	}
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_falu
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,Village_Priest,npc
		OnStoryData:Speak_with_the_Gypsies_begin,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=new,terep_fenyves,Gypsy_leader,npc,main
		OnStoryData:Speak_with_the_Gypsies_succes,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=target,terep_fenyves,Enemy_of_gypsies,soldier,kill_the_beast
		OnSet
		{
			SetTaskState=main,Completed
			SpawnMonster=Enemy_of_gypsies,Enemy_of_gypsies,terep_fenyves,Enemy_of_gypsies_position
			SetTaskState=kill_the_beast,Active
		}
		OnSoldierKilledName:Enemy_of_gypsies,terep_fenyves
		{
			SetStage=25
		}
	}
	Stage25
	{
		State=Active
		Mark=completed,terep_fenyves,Gypsy_leader,npc,go_back
		OnSet
		{
			SetTaskState=go_back,Active
			SetTaskState=kill_the_beast,Completed
			AddStoryData=Beast_killed
		}
		OnStoryData:Speak_with_the_Gypsies2_succes,keep
		{
			SetStage=30
		}
	}
	Stage30
	{
		State=Active
		Mark=completed,terep_falu,Alchemist_falu,npc,talk_alchemist
		OnSet
		{
			SetTaskState=go_back,Completed
			SetTaskState=talk_alchemist,Active
		}
		OnStoryData:dlg_alchemist02_done,keep
		{
			SetStage=35
		}
	}
	Stage35
	{
		State=Completed
	}
	Stage40
	{
		State=Failed
	}
	Stage45
	{
		State=Hidden
	}
}
Ch1_InkInTheWell
{
	Chapter=1
	Rewards=Gold(1000),XP(500)
	Task
	{
		TaskID=go_back
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:dlg_alchemist02_done,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,Alchemist_falu,npc
		OnStoryData:Ink_in_the_Well_begin,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target_pos,terep_Ink_in_the_Well,bag_of_trash_position,dummy,main
		OnSet
		{
			EnableEntrance=terep_falu,Ink_in_the_Well,true
		}
		OnItemGot:BagOfTrash
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=completed,terep_falu,Alchemist_falu,npc,go_back
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=go_back,Active
			AddStoryData=BagOfTrash_gathered
			EnableEntrance=terep_Ink_in_the_Well,entrance_to_falu,true
		}
		OnStoryData:Ink_in_the_Well_success,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Completed
	}
}
Ch1_Scarecrow
{
	Chapter=1
	Rewards=Gold(1000),XP(400),AbilityPoint(1),SkillPoint(1)
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_ink_scarecrow
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_ink_scarecrow,Scarecrow,soldier,main
		OnSoldierKilledname:Scarecrow,terep_ink_scarecrow
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
	}
}
Ch1_Bodyguarding
{
	Chapter=1
	Rewards=Gold(1000),XP(400)
	Stage0
	{
		State=Inactive
		OnMapChanged:terep_fenyves
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_fenyves,Merchant_fenyves,soldier
		OnStoryData:Bodyguarding_begin,keep
		{
			SetStage=10
		}
		OnStoryData:Act1_Ch1_delete_storydata,keep
		{
			SetStage=25
		}
	}
	Stage10
	{
		State=Active
		Mark=target_pos,terep_fenyves,merchant_fenyves_position,dummy,main
		OnStoryData:trigger_gypsy_camp_reached,keep
		{
			SetStage=15
		}
		OnSoldierKilled:Merchant_fenyves,terep_fenyves
		{
			SetStage=30
		}
		OnStoryData:Act1_Ch1_delete_storydata,keep
		{
			SetStage=30
		}
	}
	Stage15
	{
		State=Active
		Mark=completed,terep_fenyves,Merchant_fenyves,soldier,main
		OnSet
		{
			RemoveStoryData=Bodyguarding_begin
		}
		OnStoryData:Bodyguarding_success,keep
		{
			SetStage=20
		}
		OnStoryData:Act1_Ch1_delete_storydata,keep
		{
			SetStage=25
		}
	}
	Stage20
	{
		State=Completed
		OnSet
		{
			RemoveStoryData=trigger_gypsy_camp_reached
			RemoveStoryData=Bodyguarding_begin
		}
		OnStoryData:Act1_Ch1_delete_storydata,keep
		{
			DestroySoldier=Merchant_fenyves,terep_fenyves
		}
	}
	Stage25
	{
		State=Hidden
		OnSet
		{
			DestroySoldier=Merchant_fenyves,terep_fenyves
		}
	}
	Stage30
	{
		State=Failed
		OnSet
		{
			AddStoryData=bodyguarding_failed
			RemoveStoryData=Bodyguarding_begin
		}
	}
}
Ch1_Living_Ghost
{
	Chapter=1
	Rewards=Gold(1000),RandomItem(rarity:rare),XP(200)
	Stage0
	{
		State=Inactive
		OnStoryData:Living_ghost_follow,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			HasStoryData:Altar_sighted_banter,equal,1
			{
				Mark=target_pos,terep_fenyves,altar_pos,dummy,main
			}
			HasStoryData:hanged_man_visited,equal,1
			{
				Mark=target_pos,terep_fenyves,hanged_man_pos,dummy,main
			}
			EnableTrigger=terep_fenyves,altar_before,false
			EnableTrigger=terep_fenyves,hanged_man_before,false
			EnableTrigger=terep_fenyves,hanged_man_leave,false
			EnableTrigger=terep_fenyves,altar_cutscene,true
			EnableTrigger=terep_fenyves,hanged_man_cutscene,true
		}
		OnStoryData:living_ghost_completed,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
		OnSet
		{
			Mark=none,terep_fenyves,altar_pos,dummy
			Mark=none,terep_fenyves,hanged_man_pos,dummy
			RemoveStoryData=Altar_sighted_banter
			RemoveStoryData=hanged_man_visited
			RemoveStoryData=Living_ghost_follow
			RemoveStoryData=living_ghost_attack
			EnableTrigger=terep_fenyves,altar_before,false
			EnableTrigger=terep_fenyves,hanged_man_before,false
			EnableTrigger=terep_fenyves,hanged_man_leave,false
			EnableTrigger=terep_fenyves,altar_cutscene,false
			EnableTrigger=terep_fenyves,hanged_man_cutscene,false
		}
	}
}
Ch1_RusalkaAmbush
{
	Chapter=1
	Rewards=Gold(1000),RandomItem(rarity:rare),XP(1000)
	Task
	{
		TaskID=go_back
		State=Inactive
	}
	Task
	{
		TaskID=protect_church
		State=Inactive
	}
	Task
	{
		TaskID=protect_shop
		State=Inactive
	}
	Task
	{
		TaskID=protect_statue
		State=Inactive
	}
	Task
	{
		TaskID=protect_gate1
		State=Inactive
	}
	Task
	{
		TaskID=protect_gate2
		State=Inactive
	}
	Task
	{
		TaskID=protect_gate3
		State=Inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Find_the_Major_success,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,Major_falu,npc
		OnStoryData:Rusalka_ambush_begin,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		OnSet
		{
			ChangeMap=terep_falu_ejjel,Entrance_from_fields
			AddStoryData=Hivedlg_techstorydata
			SetTaskState=protect_church,Active
			SetTaskState=protect_shop,Active
			SetTaskState=protect_statue,Active
			SetTaskState=protect_gate1,Active
			SetTaskState=protect_gate2,Active
			SetTaskState=protect_gate3,Active
		}
		OnStoryData:Rusalka_ambush_mayor_appeared,keep
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=completed,terep_falu_ejjel,Major_falu,npc,go_back
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=protect_church,Hidden
			SetTaskState=protect_shop,Hidden
			SetTaskState=protect_statue,Hidden
			SetTaskState=protect_gate1,Hidden
			SetTaskState=protect_gate2,Hidden
			SetTaskState=protect_gate3,Hidden
			SetTaskState=go_back,Active
		}
		OnStoryData:Rusalka_ambush_success,keep
		{
			ChangeMap=terep_falu,Entrance_from_fields
			RemoveStoryData=Hivedlg_techstorydata
			SetStage=20
		}
	}
	Stage20
	{
		State=Completed
	}
}

Ch1_Battlefield
{
	Chapter=1
	Rewards=Gold(500),XP(300)
	Task
	{
		TaskID=go_back
		State=Inactive
	}
	
	Stage0
	{
		State=Inactive
		OnStoryData:Find_the_Major_success
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,Village_Shopkeeper,npc
		OnSet
		{
			AddStoryData=Battlefield_firstdialog_available
		}
		OnStoryData:Battlefield_begin,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		OnItemGot:Rusty_bomb
		{
			ItemCount:Rusty_bomb,greater_equal,5
			{
				SetStage=15
			}
		}
	}
	Stage15
	{
		State=Active
		Mark=completed,terep_falu,Village_Shopkeeper,npc,go_back
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=go_back,Active
			AddStoryData=Machine_parts_gathered
		}
		OnStoryData:Battlefield_success,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Completed
	}
}
Ch1_Spirit_of_the_Forest
{
	Chapter=1
	Rewards=Gold(1500),XP(1000),AbilityPoint(2),SkillPoint(1)
	Stage0
	{
		State=Inactive
		OnStoryData:Runestones_start,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		Mark=target,terep_nagyerdo,erdo_szelleme,soldier,main
		OnSet
		{
			SpawnMonster=erdo_szelleme,erdo_szelleme,terep_nagyerdo,erdo_szellem_position
		}
		OnSoldierKilledname:erdo_szelleme,terep_nagyerdo
		{
			AddStoryData=erdoszelleme_hc_done
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
	}
}
Ch1_Frog_Statue
{
	Chapter=1
	Rewards=Gold(2000),RandomItem(rarity:rare),XP(2000),AbilityPoint(1)
	Stage0
	{
		State=Inactive
		OnStoryData:Frog_statue_start,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Active
		OnSet
		{
			SpawnMonster=bekaszobor_monster,bekaszobor_monster1,terep_nagyerdo,frog_statue_monster
			SpawnMonster=bekaszobor_monster_loot,bekaszobor_monster2,terep_nagyerdo,frog_statue_monster
			Mark=target,terep_nagyerdo,bekaszobor_monster1,soldier,main
			Mark=target,terep_nagyerdo,bekaszobor_monster2,soldier,main
		}
		OnSoldierKilledName:bekaszobor_monster1,terep_nagyerdo
		{
			Mark=none,terep_nagyerdo,bekaszobor_monster1,soldier,main
			SetVariable=bekaszobor_killed,1,add
		}
		OnSoldierKilledName:bekaszobor_monster2,terep_nagyerdo
		{
			Mark=none,terep_nagyerdo,bekaszobor_monster2,soldier,main
			SetVariable=bekaszobor_killed,1,add
		}
		OnVariableChanged:bekaszobor_killed,2
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Completed
	}
}
Ch1_Dreadknecht_Camp
{
	Chapter=1
	Rewards=Gold(1000),XP(1000)
	Task
	{
		TaskID=go_back
		State=inactive
	}
	
	Stage0
	{
		State=Inactive
		OnStoryData:Find_the_Major_success,keep
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,Blacksmith,npc
		OnSet
		{
			AddStoryData=Blacksmith_questdialog_available
		}
		OnStoryData:Blacksmith_quest_begin,keep
		{
			SetStage=7
		}
	}
	Stage7
	{
		State=Active
		Mark=target,terep_nagyerdo,Dreadknecht_Camp,dummy,main
		OnStoryData:Aramtermelo_drop,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_nagyerdo,Dreadknecht_Camp,dummy,main
		OnSet
		{
			AddLoot=Essence_of_electricity_quest,terep_nagyerdo,aramtermelolootpos,dummy
		}
		OnItemGot:Essence_of_electricity_quest
		{
			SetStage=15
		}
		OnStoryData:Dreadknecht_camp_wolf_attack
		{
			SetPlayerFaction=terep_nagyerdo,Vrikolak_fogoly,1
		}
	}
	Stage15
	{
		State=Active
		Mark=completed,terep_falu,Blacksmith,npc,go_back
		OnSet
		{
			Mark=none,terep_nagyerdo,Dreadknecht_Camp,dummy,main
			SetTaskState=main,Completed
			SetTaskState=go_back,Active
			AddStoryData=Blacksmith_quest_Done
		}
		OnStoryData:Blacksmith_quest_Finish
		{
			SetStage=20
		}
		OnStoryData:Dreadknecht_camp_wolf_attack
		{
			SetPlayerFaction=terep_nagyerdo,Vrikolak_fogoly,1
		}
	}
	Stage20
	{
		State=Completed
		OnSet
		{
			RemoveStoryData=Blacksmith_questdialog_available
			RemoveStoryData=Blacksmith_quest_begin
			RemoveStoryData=Blacksmith_quest_Done
			RemoveStoryData=Aramtermelo_drop
		}
	}
}

Ch1_The_hive
{
	Chapter=1
	Rewards=Gold(2000),RandomItem(rarity:rare),XP(2000)
	Task
	{
		TaskID=go_back
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Find_the_Major_success
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,Village_Priest,npc
		OnSet
		{
			AddStoryData=Hive_dlg1_enabled
		}
		OnStoryData:The_hive_quest_begin,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_nagyerdo,Entrance_to_hive,entrance,main
		OnSet
		{
			EnableEntrance=terep_nagyerdo,Entrance_to_hive,true
		}
		OnMapChanged:terep_ink_hive
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		OnItemGot:Mystic_gem
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Active
		Mark=Completed,terep_falu,Village_Priest,npc
		OnSet
		{
			EnableEntrance=terep_ink_hive,Entrance_to_gallowsbog,true
			SetTaskState=main,Completed
			SetTaskState=go_back,Active
			AddStoryData=Hive_dlg2_enabled
		}
		OnStoryData:The_hive_quest_done
		{
			EnableTrigger=terep_falu,Katarinas_sin,true
			SetStage=25
		}
	}
	Stage25
	{
		State=Completed
		OnSet
		{
			RemoveStoryData=Hive_dlg1_enabled
			RemoveStoryData=The_hive_quest_begin
			RemoveStoryData=Hive_dlg2_enabled
		}
	}
}
Ch1_The_hiding_machines
{
	Chapter=1
	Rewards=Gold(1500),RandomItem(rarity:rare),XP(2000)
	Task
	{
		TaskID=go_back
		State=inactive
	}
	Stage0
	{
		State=Inactive
		OnStoryData:Find_the_Major_success
		{
			SetStage=5
		}
	}
	Stage5
	{
		State=Inactive
		Mark=new,terep_falu,guard_falu,npc
		OnSet
		{
			AddStoryData=Hiding_dlg1_enabled
		}
		OnStoryData:The_hiding_quest_begin,keep
		{
			SetStage=10
		}
	}
	Stage10
	{
		State=Active
		Mark=target,terep_nagyerdo,Battlefield,dummy,main
		OnSet
		{
			SetPlayerActive=terep_nagyerdo,Hidings,true
		}
		OnSoldierKilledName:DLC_ATD_nagyerdo,terep_nagyerdo
		{
			SetVariable=Destr_Hunt_mach,1,add
		}
		OnVariableChanged:Destr_Hunt_mach,4
		{
			SetStage=15
		}
	}
	Stage15
	{
		State=Active
		Mark=Completed,terep_falu,guard_falu,npc
		OnSet
		{
			SetTaskState=main,Completed
			SetTaskState=go_back,Active
			AddStoryData=Hiding_dlg2_enabled
		}
		OnStoryData:The_hiding_quest_done,keep
		{
			SetStage=20
		}
	}
	Stage20
	{
		State=Completed
		OnSet
		{
			RemoveStoryData=Hiding_dlg1_enabled
			RemoveStoryData=The_hiding_quest_begin
			RemoveStoryData=Hiding_dlg2_enabled
		}
	}
}
